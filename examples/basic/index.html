<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet/less" type="text/css"  href="../../stylesheets/EasyChart.less">
		<link rel="stylesheet/less" type="text/css"  href="../stylesheets/main.less">

		<script src="../../javascripts/dependencies/less.js" type="text/javascript"></script>
		<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="../../javascripts/dependencies/observable.js" type="text/javascript"></script>

		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="../../javascripts/Series.js" charset="utf-8"></script>
		<script src="../../javascripts/ChartView.js" charset="utf-8"></script>
		<script src="../../javascripts/AnnotationLayerView.js" charset="utf-8"></script>
		<script src="../../javascripts/XAxisView.js" charset="utf-8"></script>
		<script src="../../javascripts/YAxisView.js" charset="utf-8"></script>
		<script src="../../javascripts/EasyChart.js" charset="utf-8"></script>


	</head>

	<body>
		<div class="container">
			<script>
				(function(){
					MYCHART = new EasyChart("div.container");

					SERIES1 = MYCHART.addSeries({
						data: [],
						color:"blue"
					}).on("mouseover",function(){
						console.log("on blue series");
					});

					SERIES2 = MYCHART.addSeries({
						data: [],
						color:"red"
					});

					var XIndicator = MYCHART.makeVerticalLine()
					.style({
						stroke: "gray",
						visibility: "hidden"
					});

					var labelSeries1 = MYCHART.makeAnnotation("div").classed({
						label: true,
						series1: true
					}).style({
						visibility: "hidden"
					});

					var labelSeries2 = MYCHART.makeAnnotation("div").classed({
						label: true,
						series2: true
					}).style({
						visibility: "hidden"
					});

					var ptSeries1 = MYCHART.makeCirclePoint().style({
						stroke: "blue",
						visibility: "hidden"
					}).on("mouseover",function(){
						labelSeries1.style({
							visibility: "visible",
							left: ptSeries1.datum().relative.x + "%",
							bottom: (100-ptSeries1.datum().relative.y) + "%"
						}).html("Series 1<br>x: " + ptSeries1.datum().value.x + "<br>y: " + ptSeries1.datum().value.y);
					}).on("mouseout",function() {
						labelSeries1.style({
							visibility: "hidden"
						});					
					});

					var ptSeries2 = MYCHART.makeCirclePoint().style({
						stroke: "red",
						visibility: "hidden"
					}).on("mouseover",function(){
						labelSeries2.style({
							visibility: "visible",
							left: ptSeries2.datum().relative.x + "%",
							bottom: (100-ptSeries2.datum().relative.y) + "%"
						}).html("Series 1<br>x: " + ptSeries2.datum().value.x + "<br>y: " + ptSeries2.datum().value.y);
					}).on("mouseout",function() {
						labelSeries2.style({
							visibility: "hidden"
						});					
					});;

					for(var i=0;i<30;i++) {
						SERIES1.data.push({
							x: i,
							y: Math.round(Math.random()*10000)
						});
						SERIES2.data.push({
							x: i,
							y: Math.random()*2 - 1
						});
					}
					MYCHART.showYAxisOfSeries(SERIES1);
					MYCHART.update();

					MYCHART.on("mousemove",function(data) {
						XIndicator.style({
							left: data.relative.x + "%",
							visibility:"visible"
						});

						var valuesSeries = MYCHART.fromRelativePositionToValues(SERIES1,data.relative);
						var nearest = SERIES1.nearestPoint(valuesSeries.x);
						var relative = MYCHART.fromValuesToRelativePosition(SERIES1, nearest);
						ptSeries1.style({
							left: relative.x + "%",
							top : relative.y + "%",
							visibility: "visible"
						}).datum({
							value: nearest,
							relative: relative
						});

						valuesSeries = MYCHART.fromRelativePositionToValues(SERIES2,data.relative);
						nearest = SERIES2.nearestPoint(valuesSeries.x);
						relative = MYCHART.fromValuesToRelativePosition(SERIES2, nearest);
						ptSeries2.style({
							left: relative.x + "%",
							top : relative.y + "%",
							visibility: "visible"
						}).datum({
							value: nearest,
							relative: relative
						});;
					}).on("mouseout",function(){
						XIndicator.style({
							visibility:"hidden"
						});
						ptSeries1.style({
							visibility: "hidden"
						});
						ptSeries2.style({
							visibility: "hidden"
						});
					});

					setInterval(function(){
						//d3.select("div.container").classed({"big":!d3.select("div.container").classed("big")});
					},5000);
				})();
			</script>
		</div>
	</body>
</html>